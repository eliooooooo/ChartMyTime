{% extends "page.html.twig" %}

{% block main %}
    <div class="flex flex-col absolute w-full h-full" x-data="{ passwordOpen: false, colorPickerOpen: false, gearOpen: false }">
        <div class="relative bg-white p-3 w-full sm:w-[80%] mt-16 md:pt-0 xl:w-1/2 sm:h-auto left-1/2 top-1/3 -translate-x-1/2 -translate-y-1/3 sm:rounded-xl">
            <h2 class="text-2xl text-center border-b-[1px] border-gray-400 pb-2">User infos</h2>
            <div class="flex flex-col md:flex-row ">
                <div class="flex flex-col gap-3 pt-2 m-auto mt-0 relative">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-brush absolute hover:cursor-pointer" viewBox="0 0 16 16" @click="colorPickerOpen = !colorPickerOpen" x-show="!colorPickerOpen">
                        <path d="M15.825.12a.5.5 0 0 1 .132.584c-1.53 3.43-4.743 8.17-7.095 10.64a6.1 6.1 0 0 1-2.373 1.534c-.018.227-.06.538-.16.868-.201.659-.667 1.479-1.708 1.74a8.1 8.1 0 0 1-3.078.132 4 4 0 0 1-.562-.135 1.4 1.4 0 0 1-.466-.247.7.7 0 0 1-.204-.288.62.62 0 0 1 .004-.443c.095-.245.316-.38.461-.452.394-.197.625-.453.867-.826.095-.144.184-.297.287-.472l.117-.198c.151-.255.326-.54.546-.848.528-.739 1.201-.925 1.746-.896q.19.012.348.048c.062-.172.142-.38.238-.608.261-.619.658-1.419 1.187-2.069 2.176-2.67 6.18-6.206 9.117-8.104a.5.5 0 0 1 .596.04M4.705 11.912a1.2 1.2 0 0 0-.419-.1c-.246-.013-.573.05-.879.479-.197.275-.355.532-.5.777l-.105.177c-.106.181-.213.362-.32.528a3.4 3.4 0 0 1-.76.861c.69.112 1.736.111 2.657-.12.559-.139.843-.569.993-1.06a3 3 0 0 0 .126-.75zm1.44.026c.12-.04.277-.1.458-.183a5.1 5.1 0 0 0 1.535-1.1c1.9-1.996 4.412-5.57 6.052-8.631-2.59 1.927-5.566 4.66-7.302 6.792-.442.543-.795 1.243-1.042 1.826-.121.288-.214.54-.275.72v.001l.575.575zm-4.973 3.04.007-.005zm3.582-3.043.002.001h-.002z"/>
                    </svg>
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-x-lg absolute hover:cursor-pointer" viewBox="0 0 16 16" @click="colorPickerOpen = false" x-show="colorPickerOpen">
                        <path d="M2.146 2.854a.5.5 0 1 1 .708-.708L8 7.293l5.146-5.147a.5.5 0 0 1 .708.708L8.707 8l5.147 5.146a.5.5 0 0 1-.708.708L8 8.707l-5.146 5.147a.5.5 0 0 1-.708-.708L7.293 8z"/>
                    </svg>
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-gear absolute hover:cursor-pointer right-0" viewBox="0 0 16 16" @click="gearOpen = !gearOpen" x-show="!gearOpen">
                        <path d="M8 4.754a3.246 3.246 0 1 0 0 6.492 3.246 3.246 0 0 0 0-6.492M5.754 8a2.246 2.246 0 1 1 4.492 0 2.246 2.246 0 0 1-4.492 0"/>
                        <path d="M9.796 1.343c-.527-1.79-3.065-1.79-3.592 0l-.094.319a.873.873 0 0 1-1.255.52l-.292-.16c-1.64-.892-3.433.902-2.54 2.541l.159.292a.873.873 0 0 1-.52 1.255l-.319.094c-1.79.527-1.79 3.065 0 3.592l.319.094a.873.873 0 0 1 .52 1.255l-.16.292c-.892 1.64.901 3.434 2.541 2.54l.292-.159a.873.873 0 0 1 1.255.52l.094.319c.527 1.79 3.065 1.79 3.592 0l.094-.319a.873.873 0 0 1 1.255-.52l.292.16c1.64.893 3.434-.902 2.54-2.541l-.159-.292a.873.873 0 0 1 .52-1.255l.319-.094c1.79-.527 1.79-3.065 0-3.592l-.319-.094a.873.873 0 0 1-.52-1.255l.16-.292c.893-1.64-.902-3.433-2.541-2.54l-.292.159a.873.873 0 0 1-1.255-.52zm-2.633.283c.246-.835 1.428-.835 1.674 0l.094.319a1.873 1.873 0 0 0 2.693 1.115l.291-.16c.764-.415 1.6.42 1.184 1.185l-.159.292a1.873 1.873 0 0 0 1.116 2.692l.318.094c.835.246.835 1.428 0 1.674l-.319.094a1.873 1.873 0 0 0-1.115 2.693l.16.291c.415.764-.42 1.6-1.185 1.184l-.291-.159a1.873 1.873 0 0 0-2.693 1.116l-.094.318c-.246.835-1.428.835-1.674 0l-.094-.319a1.873 1.873 0 0 0-2.692-1.115l-.292.16c-.764.415-1.6-.42-1.184-1.185l.159-.291A1.873 1.873 0 0 0 1.945 8.93l-.319-.094c-.835-.246-.835-1.428 0-1.674l.319-.094A1.873 1.873 0 0 0 3.06 4.377l-.16-.292c-.415-.764.42-1.6 1.185-1.184l.292.159a1.873 1.873 0 0 0 2.692-1.115z"/>
                    </svg>
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-x-lg absolute hover:cursor-pointer right-0" viewBox="0 0 16 16" @click="gearOpen = false" x-show="gearOpen">
                        <path d="M2.146 2.854a.5.5 0 1 1 .708-.708L8 7.293l5.146-5.147a.5.5 0 0 1 .708.708L8.707 8l5.147 5.146a.5.5 0 0 1-.708.708L8 8.707l-5.146 5.147a.5.5 0 0 1-.708-.708L7.293 8z"/>
                    </svg>
                    <div class="bg-{{ user_color }} m-3 w-32 h-32 rounded-full" x-show="!colorPickerOpen && !gearOpen"></div>
                    <form action="user?action=updateColor" method="POST" id="colorPicker" class="p-1 border border-gray-400 w-28 h-32 m-3 ml-5 rounded-md flex gap-1 flex-col" x-show="colorPickerOpen" @click.away="colorPickerOpen = false" style="display: none;">
                        <input type="hidden" id="selectedColor" name="color" value="" />
                        <div data-value="63CDE9" class="colorChoice w-full h-full bg-63CDE9 rounded-md hover:cursor-pointer hover:opacity-80" ></div>
                        <div data-value="D988B3" class="colorChoice w-full h-full bg-D988B3 rounded-md hover:cursor-pointer hover:opacity-80" ></div>
                        <div data-value="46A457" class="colorChoice w-full h-full bg-46A457 rounded-md hover:cursor-pointer hover:opacity-80" ></div>
                    </form>
                    <div id="colorPicker" class="p-1 border border-gray-400 w-28 h-32 m-3 ml-5 rounded-md flex gap-1 flex-col" x-show="gearOpen" @click.away="gearOpen = false" style="display: none;">
                        <form action="user?action=delete" id="gearUser1" method="POST">
                            <input type="hidden" id="id_user" name="id_user" value="{{ user.0.id }}" />
                            <div class="gearUserSelect text-red-500 hover:cursor-pointer w-full hover:opacity-80 hover:underline text-center" data-value="1">Delete account</div>
                        </form>
                        <form action="user?action=logout" id="gearUser2" method="POST">
                            <input type="hidden" id="id_user" name="id_user" value="{{ user.0.id }}" />
                            <div class="gearUserSelect hover:cursor-pointer w-full hover:opacity-80 hover:underline text-center" data-value="2">Logout</div>
                        </form>
                        {# <input type="hidden" id="id_user" name="id_user" value="{{ user.0.id }}" />
                        <div class="hover:cursor-pointer w-full hover:opacity-80 hover:underline text-center" >Logout</div> #}
                    </div>
                    <div class="w-32 mx-3"><p class="text-center">{{ user.0.username }}</p></div>
                </div>
                <div class="w-full mx-2 sm:mx-0 mt-4 flex flex-col gap-2">
                    <p class="sm:ml-10"><b>E-mail :</b> {{ user.0.email }} </p>
                    <div class="relative flex flex-row">
                        <p class="sm:ml-10"><b>Password :</b> <span x-show="!passwordOpen"> *****</span></p>
                        <div href="#" class="absolute right-2 sm:right-10 text-gray-400 hover:text-black hover:cursor-pointer underline toggleStep" @click="passwordOpen = !passwordOpen" tabindex="0">
                            <span x-show="!passwordOpen">Edit</span>
                            <span x-show="passwordOpen">Close</span>
                        </div>
                    </div>
                    <form method="POST" action="user?action=update" id="updatePassword" class="sm:ml-10 mr-2 pl-3 border-l-[1px] border-gray-400" x-show="passwordOpen" x-transition novalidate stryle="display: none;">
                        <div class="relative w-fit">
                            <div class="form-group relative flex flex-col">
                                <label for="password"><b>Current password <span class="required">*</span></b></label>
                                <input id="password" name="password" type="password" class="w-full border-[1px] border-gray-400 rounded-lg p-1 my-1" placeholder="Current password" required autocomplete="current-password">
                            </div>
                            <input type="checkbox" class="showPassword" tabindex="-1">
                        </div>
                        <div class="relative w-fit">
                            <div class="form-group formgroupPassword relative flex flex-col">
                                <label for="newPassword"><b>New password <span class="required">*</span></b></label>
                                <input id="newPassword" name="newPassword" type="password" class="w-full border-[1px] border-gray-400 rounded-lg p-1 my-1" placeholder="New password" required autocomplete="off" data-pristine-password>
                                <div id="errorPassword" class="hidden">Password must contain :</div>
                            </div>
                            <input type="checkbox" class="showPassword" tabindex="-1">
                        </div>
                        <div class="relative w-fit">
                            <div class="form-group relative flex flex-col">
                                <label for="confirmPassword"><b>Confirm new password <span class="required">*</span></b></label>
                                <input id="confirmPassword" name="confirmPassword" type="password" class="w-full border-[1px] border-gray-400 rounded-lg p-1 my-1" placeholder="Confirm new password" required autocomplete="off" data-pristine-equals="#updatePassword #newPassword">
                            </div>
                            <input type="checkbox" class="showPassword" tabindex="-1">
                        </div>
                        <div class="flex flex-col gap-1 mt-2">
                            <input type="submit" value="Edit">
                            <p class="text-left"><span class="required"><b>*</b></span> Required</p>
                        </div>
                    </form>
                    <div class="sm:ml-10">
                        <p><b>Notification preferences :</b></p>
                        <form class="pl-3 border-l-[1px] border-gray-400">
                            <div class="flex flex-row gap-2">
                                <input type="checkbox" id="notif1" name="notif1" value="notif1">
                                <label for="notif1">Daily reminder</label>
                            </div>
                            <div class="flex flex-row gap-2">
                                <input type="checkbox" id="notif2" name="notif2" value="notif2">
                                <label for="notif2">Weekly report</label>
                            </div>
                        </form>
                    </div>
                    <div class="sm:ml-10">
                        <p><b>Account creation date :</b> {{ user.0.date|date('d-m-Y') }}</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

{% endblock %}
{% block scripts %}
    <!-- Gère les infobulles -->
    <script src="https://unpkg.com/@popperjs/core@2"></script>
    <script src="https://unpkg.com/tippy.js@6"></script>
    <script src="dist/pristine.js"></script>
    <script src="dist/colorpicker.js"></script>
{% endblock %}
